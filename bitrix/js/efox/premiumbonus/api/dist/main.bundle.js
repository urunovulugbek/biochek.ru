this.BX=this.BX||{},this.BX.Efox=this.BX.Efox||{},function(a){'use strict';function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),Object.defineProperty(a,"prototype",{writable:!1}),a}function e(a){"@babel/helpers - typeof";return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function h(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function i(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&j(a,b)}function j(a,b){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},j(a,b)}function k(a){var b=n();return function(){var c,d=p(a);if(b){var e=p(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return l(this,c)}}function l(a,b){if(b&&("object"===e(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return m(a)}function m(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function p(a){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},p(a)}function q(a){"@babel/helpers - typeof";return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},q(a)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function s(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function t(a,b,c){return b&&s(a.prototype,b),c&&s(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(a,b,c){var d=v(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(3>arguments.length?a:c):e.value}},u.apply(this,arguments)}function v(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=C(a),null!==a););return a}function w(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&x(a,b)}function x(a,b){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},x(a,b)}function y(a){var b=B();return function(){var c,d=C(a);if(b){var e=C(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return z(this,c)}}function z(a,b){if(b&&("object"===q(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return A(a)}function A(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function B(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function C(a){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},C(a)}function D(a){"@babel/helpers - typeof";return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},D(a)}function E(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function F(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function G(a,b,c){return b&&F(a.prototype,b),c&&F(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function H(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&I(a,b)}function I(a,b){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},I(a,b)}function J(a){var b=M();return function(){var c,d=N(a);if(b){var e=N(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return K(this,c)}}function K(a,b){if(b&&("object"===D(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return L(a)}function L(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function M(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function N(a){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},N(a)}function O(a){"@babel/helpers - typeof";return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},O(a)}function P(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function Q(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function R(a,b,c){return b&&Q(a.prototype,b),c&&Q(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function S(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&T(a,b)}function T(a,b){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},T(a,b)}function U(a){var b=X();return function(){var c,d=Y(a);if(b){var e=Y(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return V(this,c)}}function V(a,b){if(b&&("object"===O(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return W(a)}function W(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function X(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function Y(a){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Y(a)}function Z(a){"@babel/helpers - typeof";return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Z(a)}function _(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function aa(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function ba(a,b,c){return b&&aa(a.prototype,b),c&&aa(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function ca(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),b&&da(a,b)}function da(a,b){return da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},da(a,b)}function ea(a){var b=ha();return function(){var c,d=ia(a);if(b){var e=ia(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return fa(this,c)}}function fa(a,b){if(b&&("object"===Z(b)||"function"==typeof b))return b;if(void 0!==b)throw new TypeError("Derived constructors may only return object or undefined");return ga(a)}function ga(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function ha(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function ia(a){return ia=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ia(a)}var ja={REGISTER:"REGISTER",EDIT:"EDIT",ORDER:"ORDER",PHONE:"PHONE"},ka="BX.Efox.PremiumBonus.Phone:",la="BX.Efox.PremiumBonus.BonusWriteOff:",ma="BX.Efox.PremiumBonus.Balance:",na={VUE_INIT:"BX.Efox.PremiumBonus:vueInit",VUE_INIT_TIMEOUT:1e3,VERIFY:{OPEN:ka+"open",BEFORE_OPEN:ka+"beforeOpen",CLOSE:ka+"close",SENDED:ka+"sended",VERIFIED:ka+"verified",ALREADY_VERIFIED:ka+"alreadyVerified",SET_PHONE:ka+"setPhone",PROPERTY_UPDATE:ka+"propertyUpdate",SET_OPTIONS:ka+"setOptions",NO_PHONE_VERIFY:ka+"noPhoneVerify"},ORDER:{OPEN:"BX.Efox.PremiumBonus.Order:"+"open"},BONUS_WRITE_OFF:{OPEN:la+"open",CLOSE:la+"close",RELOAD:la+"reload",UPDATED:la+"updated",PROPERTY_UPDATE:la+"propertyUpdate"},BALANCE:{OPEN:ma+"open",CLOSE:ma+"close",RELOAD:ma+"reload",ERROR:ma+"errors"}},oa={VERIFY:"/bitrix/tools/efox.premiumbonus/phone.verify.form/",ORDER:"/bitrix/tools/efox.premiumbonus/order/",BALANCE:"/bitrix/tools/efox.premiumbonus/balance/"},pa=function(){function a(){b(this,a)}return d(a,[{key:"logError",value:function(a){console.error("efox.premiumbonus error:",a)}},{key:"logInfo",value:function(a){console.info("efox.premiumbonus info:",a)}}]),a}(),qa=function(a){function b(){var a;return f(this,b),a=c.call(this),a.options=a.defaultOptions(),a}i(b,a);var c=k(b);return h(b,[{key:"defaultOptions",value:function(){return{container:"",ajaxUrl:""}}},{key:"setOptions",value:function(a){this.options=Object.assign(this.defaultOptions(),a),this.initContainer()}},{key:"initContainer",value:function(){this.options.container?this.obHtml=$(this.options.container):($("body").append($("<div id='efpbInternalContainer' style='display:none;'></div>")),this.options.container="#efpbInternalContainer",this.obHtml=$(this.options.container))}},{key:"init",value:function(a){this.setOptions(a),0>=this.obHtml.length||this.loadComponent(this.getLoadComponentParams())}},{key:"getLoadComponentParams",value:function(){return{}}},{key:"loadComponent",value:function(a){var b=this;BX.ajax({url:this.options.ajaxUrl,method:"post",dataType:"html",async:!0,processData:!0,emulateOnload:!0,start:!0,scriptsRunFirst:!0,data:a,onsuccess:function(a){a?(b.obHtml.html(a),setTimeout(function(){BX.onCustomEvent(na.VUE_INIT)},na.VUE_INIT_TIMEOUT)):b.logError(a)},onfailure:function(a,c){b.logError(c)}})}}]),b}(pa),ra=function(a){function b(){return r(this,b),c.apply(this,arguments)}w(b,a);var c=y(b);return t(b,[{key:"defaultOptions",value:function(){return{type:"",phoneSelector:"",container:"",ajaxUrl:oa.VERIFY,updateOnChange:!1,updateOnVerified:!1,disableFormBeforeVerify:!0,formId:""}}},{key:"setOptions",value:function(a){this.options=Object.assign(this.defaultOptions(),a),this.initPhoneSelector(),this.initContainer(),this.initRegisterSubmit()}},{key:"initPhoneSelector",value:function(){return this.options.phoneSelector?void(this.obPhone=$(this.options.phoneSelector)):void(this.obPhone=!1)}},{key:"initContainer",value:function(){this.obPhone&&0<this.obPhone.length?(this.obPhone.after($("<div id='efpbInternalPhoneContainer'></div>")),this.options.container="#efpbInternalPhoneContainer",this.obHtml=$(this.options.container)):this.options.container?this.obHtml=$(this.options.container):($("body").append($("<div id='efpbInternalContainer' style='display:none;'></div>")),this.options.container="#efpbInternalContainer",this.obHtml=$(this.options.container))}},{key:"initRegisterSubmit",value:function(){var a=this;this.obForm=!1,this.obSubmit=!1,"REGISTER"!==this.options.type||(this.options.formId?this.obForm=$(this.options.formId):this.obHtml&&0<this.obHtml.length&&(0<this.obHtml.parents("form").length?this.obForm=$(this.obHtml.parents("form")[0]):$("body").find("form").each(function(){0<$(this).find("[name=AUTH_FORM]").length&&0<$(this).find("[name=TYPE][value=REGISTRATION]").length&&(a.obForm=$(this))})),0<this.obForm.length&&(this.obSubmit=this.obForm.find("input[type=submit]")))}},{key:"getLoadComponentParams",value:function(){return{type:this.options.type,phone:this.obPhone?this.obPhone.val():""}}},{key:"init",value:function(a){var c=this;u(C(b.prototype),"init",this).call(this,a),this.obPhone&&0<this.obPhone.length?(this.updatePhone(),this.options.updateOnChange&&this.obPhone.on("change",function(){c.updatePhone()})):this.logInfo("\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \u043F\u043E\u043B\u0435 "+this.options.phoneSelector+" \u0434\u043B\u044F \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438 \u0444\u043E\u0440\u043C\u044B \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),this.options.disableFormBeforeVerify&&this.obSubmit&&0<this.obSubmit.length&&this.obSubmit.attr("disabled","disabled")}},{key:"updatePhone",value:function(){var a=this.obPhone.val();BX.onCustomEvent(na.VERIFY.SET_PHONE,[{phone:a,disabled:!!a}])}},{key:"setVerifiedPhone",value:function(a){this.options.updateOnVerified&&this.obPhone&&0<this.obPhone.length&&(this.obPhone.val(a),this.obPhone.attr("readonly","readonly")),BX.onCustomEvent(na.VERIFY.SET_OPTIONS,[{showVerifiedPhone:this.options.type===ja.REGISTER&&(!this.obPhone||0==this.obPhone.length)}]),this.setSubmitAvailable()}},{key:"setSubmitAvailable",value:function(){this.options.disableFormBeforeVerify&&this.obSubmit&&0<this.obSubmit.length&&this.obSubmit.removeAttr("disabled")}}]),b}(qa),sa=function(a){function b(){return E(this,b),c.apply(this,arguments)}H(b,a);var c=J(b);return G(b,[{key:"defaultOptions",value:function(){return{ajaxUrl:oa.ORDER,container:""}}},{key:"getLoadComponentParams",value:function(){return{personTypeId:this.getCurrentPersonType()}}},{key:"getCurrentPersonType",value:function(){return $("[name=PERSON_TYPE]").val()}}]),b}(qa),ta=function(a){function b(){return P(this,b),c.apply(this,arguments)}S(b,a);var c=U(b);return R(b,[{key:"defaultOptions",value:function(){return{ajaxUrl:oa.BALANCE,container:""}}}]),b}(qa),ua=function(a){function b(){var a;return _(this,b),a=c.call(this),a.EVENTS=na,a.verifyForm=new ra,a.orderForm=new sa,a.balanceForm=new ta,a.setVerified(!1),a.setPhone(""),BX.addCustomEvent(na.VERIFY.ALREADY_VERIFIED,function(b){b.phone&&(a.logInfo("phone already verified "+b.phone),a.setVerifiedPhone(b.phone))}),BX.addCustomEvent(na.VERIFY.NO_PHONE_VERIFY,function(){a.verifyForm.setSubmitAvailable()}),BX.addCustomEvent(na.VERIFY.VERIFIED,function(b){b.phone&&(a.logInfo("verified "+b.phone),a.setVerifiedPhone(b.phone),a.verifyForm.setVerifiedPhone(b.phone))}),BX.addCustomEvent(na.ORDER.OPEN,function(){a.isVerified()?BX.onCustomEvent(na.BONUS_WRITE_OFF.RELOAD,[{phone:a.getPhone(),open:!0}]):BX.onCustomEvent(na.VERIFY.OPEN)}),a}ca(b,a);var c=ea(b);return ba(b,[{key:"initVerifyForm",value:function(a){return this.verifyForm.init(a),this}},{key:"initOrder",value:function(a){return this.orderForm.init(a),this}},{key:"initBalance",value:function(a){return this.balanceForm.init(a),this}},{key:"setPhone",value:function(a){return this.phone=a,this}},{key:"getPhone",value:function(){return this.phone}},{key:"setVerifiedPhone",value:function(a){this.setVerified(),this.setPhone(a)}},{key:"setVerified",value:function(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.verified=a,this}},{key:"isVerified",value:function(){return this.verified}}]),b}(pa);a.Api=new ua}(this.BX.Efox.PremiumBonus=this.BX.Efox.PremiumBonus||{});
//# sourceMappingURL=main.bundle.js.map
